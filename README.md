IT IS NEEDED TO PREVIEW MD FILE TO SEE DIAGRAMS

I considered this architecture:
<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="572px" preserveAspectRatio="none" style="width:509px;height:572px;background:#FFFFFF;" version="1.1" viewBox="0 0 509 572" width="509px" zoomAndPan="magnify"><defs/><g><!--entity postgres1--><g id="elem_postgres1"><path d="M402.6,291.5 C402.6,281.5 447.6,281.5 447.6,281.5 C447.6,281.5 492.6,281.5 492.6,291.5 L492.6,316.7969 C492.6,326.7969 447.6,326.7969 447.6,326.7969 C447.6,326.7969 402.6,326.7969 402.6,316.7969 L402.6,291.5 " fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M402.6,291.5 C402.6,301.5 447.6,301.5 447.6,301.5 C447.6,301.5 492.6,301.5 492.6,291.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="412.6" y="318.4951">postgres1</text></g><!--entity postgres2--><g id="elem_postgres2"><path d="M111.6,520.5 C111.6,510.5 156.6,510.5 156.6,510.5 C156.6,510.5 201.6,510.5 201.6,520.5 L201.6,545.7969 C201.6,555.7969 156.6,555.7969 156.6,555.7969 C156.6,555.7969 111.6,555.7969 111.6,545.7969 L111.6,520.5 " fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M111.6,520.5 C111.6,530.5 156.6,530.5 156.6,530.5 C156.6,530.5 201.6,530.5 201.6,520.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="121.6" y="547.4951">postgres2</text></g><!--entity redis--><g id="elem_redis"><path d="M129.1,291.5 C129.1,281.5 156.6,281.5 156.6,281.5 C156.6,281.5 184.1,281.5 184.1,291.5 L184.1,316.7969 C184.1,326.7969 156.6,326.7969 156.6,326.7969 C156.6,326.7969 129.1,326.7969 129.1,316.7969 L129.1,291.5 " fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M129.1,291.5 C129.1,301.5 156.6,301.5 156.6,301.5 C156.6,301.5 184.1,301.5 184.1,291.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="139.1" y="318.4951">redis</text></g><!--entity client--><g id="elem_client"><ellipse cx="274.6" cy="14" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M274.6,22 L274.6,49 M261.6,30 L287.6,30 M274.6,49 L261.6,64 M274.6,49 L287.6,64 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="255.1" y="78.4951">client</text></g><!--entity product-service--><g id="elem_product-service"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="151" x="199.1" y="158.5"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="330.1" y="163.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="328.1" y="165.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="328.1" y="169.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="214.1" y="191.4951">product-service</text></g><!--entity review-calculation-service--><g id="elem_review-calculation-service"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="226" x="43.6" y="403.5"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="249.6" y="408.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="247.6" y="410.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="247.6" y="414.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="186" x="58.6" y="436.4951">review-calculation-service</text></g><!--link client to product-service--><g id="link_client_product-service"><path d="M274.6,87.66 C274.6,112.2 274.6,131.53 274.6,152.27 " fill="none" id="client-product-service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="274.6,81.66,270.6,90.66,274.6,86.66,278.6,90.66,274.6,81.66" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="274.6,158.27,278.6,149.27,274.6,153.27,270.6,149.27,274.6,158.27" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="275.6" y="124.5669">REST API</text></g><!--link product-service to postgres1--><g id="link_product-service_postgres1"><path d="M350.2,202.58 C370.01,210.32 390.35,220.72 406.6,234.5 C421.39,247.05 429.7756,260.9031 436.5956,275.8231 " fill="none" id="product-service-to-postgres1" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="439.09,281.28,438.9864,271.4317,437.0113,276.7326,431.7105,274.7575,439.09,281.28" style="stroke:#181818;stroke-width:1.0;"/></g><!--link product-service to redis--><g id="link_product-service_redis"><path d="M198.94,188.68 C136.53,195.54 55.04,209.15 34.6,234.5 C6,269.95 78.8434,289.1109 123.0234,297.4209 " fill="none" id="product-service-to-redis" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="128.92,298.53,120.8145,292.9353,124.0062,297.6057,119.3357,300.7974,128.92,298.53" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="35.6" y="247.5669">CalculationMessage (pub/sub)</text></g><!--link redis to product-service--><g id="link_redis_product-service"><path d="M184.21,289.34 C200.57,280.26 220.92,267.14 235.6,251.5 C248.4,237.86 256.0706,224.6661 262.8206,210.2161 " fill="none" id="redis-to-product-service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="265.36,204.78,257.9269,211.2413,263.2439,209.3101,265.175,214.6271,265.36,204.78" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="249.6" y="247.5669">AverageRating (cache)</text></g><!--link redis to review-calculation-service--><g id="link_redis_review-calculation-service"><path d="M128.95,308.07 C100.1,312.92 56.25,325.27 35.6,356.5 C21.79,377.38 33.4106,390.297 58.7206,401.087 " fill="none" id="redis-to-review-calculation-service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="64.24,403.44,57.5296,396.2309,59.6405,401.4792,54.3923,403.5901,64.24,403.44" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="36.6" y="369.5669">CalculationMessage (pub/sub)</text></g><!--link review-calculation-service to redis--><g id="link_review-calculation-service_redis"><path d="M210.57,403.38 C230.91,391.51 246.92,375.42 236.6,356.5 C225.52,336.2 208.1276,325.1034 189.6676,317.0334 " fill="none" id="review-calculation-service-to-redis" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="184.17,314.63,190.8142,321.9001,188.7514,316.6328,194.0187,314.5699,184.17,314.63" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="241.6" y="369.5669">AverageRating (cache)</text></g><!--link review-calculation-service to postgres2--><g id="link_review-calculation-service_postgres2"><path d="M156.6,449.66 C156.6,467.52 156.6,486.48 156.6,504.23 " fill="none" id="review-calculation-service-to-postgres2" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="156.6,510.23,160.6,501.23,156.6,505.23,152.6,501.23,156.6,510.23" style="stroke:#181818;stroke-width:1.0;"/></g><!--SRC=[ZP0_QmCn3CLtVmfjJGVtICPG2g5qw50eQRPmWqudBWQVRIpvylLxQVwrJK8x28JyVkyzVBTHJJAlgkGnQEdz0yM-6YV5m45jwx3Bs1lJecA3mf2YQ9TPffUdsVcKkNLYa3Hc8Ez6AsFM-wM6HskVO9roR0kf5Sw38wvX3ikNZnKitb_DvUCUEMRNjnHVkJkhP_HKFAgBuOr5i6EOfD9KKffxSvGTaC7nrj8P-5xfBv_Rx8_6i_eVubFvnS1vJ5gEej31X90s_AlrbT-xJdq2]--></g></svg>

But than found a way where I could eliminate one database and improve "caching" of average ratings:
<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="455px" preserveAspectRatio="none" style="width:507px;height:455px;background:#FFFFFF;" version="1.1" viewBox="0 0 507 455" width="507px" zoomAndPan="magnify"><defs/><g><!--entity postgres--><g id="elem_postgres"><path d="M6,291.5 C6,281.5 46.5,281.5 46.5,281.5 C46.5,281.5 87,281.5 87,291.5 L87,316.7969 C87,326.7969 46.5,326.7969 46.5,326.7969 C46.5,326.7969 6,326.7969 6,316.7969 L6,291.5 " fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M6,291.5 C6,301.5 46.5,301.5 46.5,301.5 C46.5,301.5 87,301.5 87,291.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="16" y="318.4951">postgres</text></g><!--entity redis--><g id="elem_redis"><path d="M122,291.5 C122,281.5 149.5,281.5 149.5,281.5 C149.5,281.5 177,281.5 177,291.5 L177,316.7969 C177,326.7969 149.5,326.7969 149.5,326.7969 C149.5,326.7969 122,326.7969 122,316.7969 L122,291.5 " fill="#F1F1F1" style="stroke:#181818;stroke-width:0.5;"/><path d="M122,291.5 C122,301.5 149.5,301.5 149.5,301.5 C149.5,301.5 177,301.5 177,291.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="132" y="318.4951">redis</text></g><!--entity client--><g id="elem_client"><ellipse cx="149.5" cy="14" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M149.5,22 L149.5,49 M136.5,30 L162.5,30 M149.5,49 L136.5,64 M149.5,49 L162.5,64 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="130" y="78.4951">client</text></g><!--entity product-service--><g id="elem_product-service"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="151" x="74" y="158.5"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="205" y="163.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="203" y="165.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="203" y="169.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="89" y="191.4951">product-service</text></g><!--entity review-calculation-service--><g id="elem_review-calculation-service"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="226" x="146.5" y="403.5"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="352.5" y="408.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="350.5" y="410.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="350.5" y="414.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="186" x="161.5" y="436.4951">review-calculation-service</text></g><!--link client to product-service--><g id="link_client_product-service"><path d="M149.5,87.66 C149.5,112.2 149.5,131.53 149.5,152.27 " fill="none" id="client-product-service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="149.5,81.66,145.5,90.66,149.5,86.66,153.5,90.66,149.5,81.66" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="149.5,158.27,153.5,149.27,149.5,153.27,145.5,149.27,149.5,158.27" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="150.5" y="124.5669">REST API</text></g><!--link product-service to postgres--><g id="link_product-service_postgres"><path d="M130.61,204.6 C111.91,226.48 87.3583,255.199 68.8283,276.879 " fill="none" id="product-service-to-postgres" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="64.93,281.44,73.8182,277.1973,68.1786,277.6391,67.7368,271.9996,64.93,281.44" style="stroke:#181818;stroke-width:1.0;"/></g><!--link product-service to redis--><g id="link_product-service_redis"><path d="M147.73,204.56 C146.84,218.1 146.04,235.8 146.5,251.5 C146.79,261.35 146.9968,266.2522 147.5868,275.4722 " fill="none" id="product-service-to-redis" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="147.97,281.46,151.3871,272.2229,147.6507,276.4702,143.4034,272.7338,147.97,281.46" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="147.5" y="247.5669">CalculationMessage (pub/sub)</text></g><!--link redis to review-calculation-service--><g id="link_redis_review-calculation-service"><path d="M142.46,326.74 C139.18,341.12 137.7,359.77 146.5,373.5 C154.71,386.32 161.7007,393.1505 175.1607,400.4805 " fill="none" id="redis-to-review-calculation-service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="180.43,403.35,174.4391,395.5328,176.0389,400.9587,170.613,402.5586,180.43,403.35" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="147.5" y="369.5669">CalculationMessage (pub/sub)</text></g><!--link review-calculation-service to product-service--><g id="link_review-calculation-service_product-service"><path d="M316.66,403.33 C328.95,395.77 340.38,385.98 347.5,373.5 C378.12,319.84 385.23,283.42 347.5,234.5 C332.31,214.8 280.425,202.1064 231.175,193.7264 " fill="none" id="review-calculation-service-to-product-service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="225.26,192.72,233.4615,198.173,230.1892,193.5587,234.8034,190.2863,225.26,192.72" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="373.5" y="308.5669">PUT Average rating</text></g><!--SRC=[XOzF2y8m3CNl_HIzgOUwkuWWui638FuvZHsoBin2rvOcdL_VpKqKP7W8XEJztajcT-P0gomB5XodnYwrRxAkWdVeM5K6wWYD41Kmb40eWoUk8z9d4h4o942pZr9Rqs52v4DJoBLI6vc7wAkaMH76rcWiv4gUzvUht9uEudSv86DECILunVPEEx0wMM3ZtH69e4Ov3wdCA9KByPQDI6lmeVG7-BxedyyqE_NZwTQzs6BihMB7k5ey0G00]--></g></svg>

Reasoning/explanation:
- All data are stored in single database, so that it is easier to join them
- Redis here is used as MQ (pub/sub mode) to send review calculation messages from product-service to review-calculation-service
- For average rating calculation, there is no need to have all the review present. These fields of CalculationMessage are enough:
   - averageRating;
   - originalCount;
   - countChange;
   - ratingChange;
- Final average rating is:

      newAverageRating = (averageRating * originalCount + ratingChange) / (originalCount + countChange)  

- review-calculation-service informs product service about new average rating via private REST endpoint
- Average rating is stored in products table
- I know there was this sentence "Product reviews and average product ratings should be cached."
   - To me storing those values in single database is far better "caching" storing them is separate in separate redis instance
   - I believe it is worth to avoid caching if possible
   - This would be faster, because I don't need to combine response from database and cache, single select is needed here
- I did not have time to figure out enum for review.rating, **Nest.js stack is new to me, so I had to learn a lot on the way**
- Typescript and ESLint configs were generated by Nest.js, didn't touch them

Further steps:
- Create authorization for private updateAverageRating endpoint, so that only review-calculation-service is able to call it
- Use more black box testing, that would cover also controller mappings
- Test also review-calculation-service
- Add authentication
- Tidy up URLs and env variables
- Secure postgres and redis much more
- Create Terraform orchestration, plug the project into CI/CD 

